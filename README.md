# Thread Console (å°è©±ç´€éŒ„ç®¡ç†ç³»çµ±)

é€™æ˜¯ä¸€å€‹åŸºæ–¼ Flask é–‹ç™¼çš„ OpenAI Thread å°è©±ç´€éŒ„ç®¡ç†èˆ‡æœå°‹ç³»çµ±ã€‚æ”¯æ´å¤šç¾¤çµ„ç®¡ç†ã€è§’è‰²æ¬Šé™æ§åˆ¶ (RBAC)ã€ä»¥åŠå®Œæ•´çš„è³‡å®‰é˜²è­·æ©Ÿåˆ¶ã€‚

## âœ¨ ä¸»è¦åŠŸèƒ½

*   **ğŸ” å…¬é–‹æœå°‹ä»‹é¢**:
    *   æ”¯æ´é—œéµå­—æœå°‹å°è©±å…§å®¹ã€‚
    *   æ”¯æ´æ—¥æœŸç¯„åœç¯©é¸ã€‚
    *   æœå°‹çµæœé—œéµå­—é«˜äº®é¡¯ç¤ºã€‚
    *   XSS é˜²è­· (è‡ªå‹•éæ¿¾å±éšª HTML æ¨™ç±¤)ã€‚

*   **âš™ï¸ å¼·å¤§ç®¡ç†å¾Œå°**:
    *   **è§’è‰²æ¬Šé™æ§åˆ¶ (RBAC)**:
        *   **Admin (è¶…ç´šç®¡ç†å“¡)**: å¯ç®¡ç†æ‰€æœ‰ç¾¤çµ„ã€æ–°å¢/åˆªé™¤æ•™å¸«å¸³è™Ÿã€æŸ¥çœ‹å®Œæ•´ç³»çµ±æ—¥èªŒã€‚
        *   **Teacher (æ•™å¸«)**: åƒ…èƒ½ç®¡ç†è‡ªå·±å»ºç«‹çš„ç¾¤çµ„ï¼Œç¢ºä¿è³‡æ–™éš”é›¢ã€‚
    *   **ç¾¤çµ„ç®¡ç† (Groups)**: æ”¯æ´å»ºç«‹å¤šå€‹å°è©±ç¾¤çµ„ï¼Œå¯å€‹åˆ¥ç¶å®šä¸åŒçš„ OpenAI API Keyã€‚
    *   **è³‡æ–™åŒ¯å…¥/åŒ¯å‡º**: æ”¯æ´ä¸Šå‚³ Excel (`.xlsx`) æ‰¹æ¬¡æ–°å¢æˆ–åˆªé™¤ Thread IDsã€‚
    *   **ç³»çµ±æ—¥èªŒ (Audit Log)**: è¨˜éŒ„æ‰€æœ‰æ•æ„Ÿæ“ä½œï¼ˆå¦‚ç™»å…¥ã€å»ºç«‹å¸³è™Ÿã€åˆªé™¤ç¾¤çµ„ï¼‰ã€‚

*   **ğŸ›¡ï¸ è³‡å®‰é˜²è­·**:
    *   **å¸³æˆ¶é–å®š**: IP é€£çºŒç™»å…¥å¤±æ•— 5 æ¬¡ï¼Œé–å®š 15 åˆ†é˜ (é˜²æš´åŠ›ç ´è§£)ã€‚
    *   **å¯†ç¢¼å¼·åº¦**: å¼·åˆ¶æ•™å¸«å¸³è™Ÿå¯†ç¢¼éœ€ 10-15 å­—å…ƒï¼Œä¸”åŒ…å«è‹±æ•¸æ··åˆã€‚
    *   **è³‡æ–™åŠ å¯†**: API Key åœ¨å„²å­˜æ™‚é€²è¡ŒåŠ å¯†ä¿è­·ã€‚
    *   **API Key å¿…å¡«**: å»ºç«‹ç¾¤çµ„æ™‚å¼·åˆ¶ç¶å®š API Keyï¼Œé¿å…é…ç½®éŒ¯èª¤ã€‚

---

## ğŸš€ å¿«é€Ÿé–‹å§‹

### 1. ç’°å¢ƒéœ€æ±‚
*   Python 3.9+
*   OpenAI API Key

### 2. å®‰è£ä¾è³´
```bash
pip install -r requirements.txt
```

### 3. è¨­å®šç’°å¢ƒè®Šæ•¸
è«‹è¤‡è£½ `.env.example` ç‚º `.env` ä¸¦å¡«å…¥æ‚¨çš„è¨­å®šï¼š
```bash
cp .env.example .env
```

**`.env` è¨­å®šç¯„ä¾‹**:
```env
# OpenAI API Key (ç³»çµ±é è¨­)
OPENAI_API_KEY=sk-your-key-here

# ç®¡ç†å“¡å¯†ç¢¼ (å¯è¨­å®šå¤šçµ„ï¼Œç”¨é€—è™Ÿåˆ†éš”)
ADMIN_PASSWORD=admin123,backup456

# Session åŠ å¯†é‡‘é‘° (è«‹è¨­å®šä¸€é•·ä¸²éš¨æ©Ÿå­—ä¸²)
SECRET_KEY=your-secret-key-change-me
```

### 4. å•Ÿå‹•ä¼ºæœå™¨
```bash
python run_server.py
```
é è¨­æœƒé‹è¡Œåœ¨ `http://0.0.0.0:8000`

---

## ğŸ³ Docker éƒ¨ç½²

æœ¬å°ˆæ¡ˆå·²åŒ…å« `Dockerfile`ï¼Œå¯ç›´æ¥å»ºç½®ä¸¦é‹è¡Œï¼š

1.  **å»ºç½® Image**:
    ```bash
    docker build -t thread-console .
    ```

2.  **é‹è¡Œ Container**:
    ```bash
    docker run -d -p 8000:8000 \
      --name thread-console \
      --env-file .env \
      -v $(pwd)/threads.json:/app/threads.json \
      -v $(pwd)/users.json:/app/users.json \
      -v $(pwd)/access.log:/app/access.log \
      -v $(pwd)/audit.log:/app/audit.log \
      thread-console
    ```
    *å»ºè­°æ›è¼‰ `.json` èˆ‡ `.log` æª”æ¡ˆä»¥ç¢ºä¿è³‡æ–™æŒä¹…åŒ–ã€‚*

---

## ğŸ‘¥ ä½¿ç”¨è€…æŒ‡å—

### ç™»å…¥ç³»çµ±
*   **Admin**: ç›´æ¥è¼¸å…¥ `.env` ä¸­è¨­å®šçš„ `ADMIN_PASSWORD` å³å¯ç™»å…¥ã€‚
*   **Teacher**: è¼¸å…¥ Admin å»ºç«‹çš„å¯†ç¢¼é€²è¡Œç™»å…¥ã€‚

### ç®¡ç†å¾Œå° (Admin Panel)
1.  **ç®¡ç†ç¾¤çµ„**: å·¦å´åˆ—è¡¨å¯åˆ‡æ›ä¸åŒç¾¤çµ„ã€‚Admin å¯çœ‹åˆ°æ¯å€‹ç¾¤çµ„çš„å»ºç«‹è€…ã€‚
2.  **å»ºç«‹æ•™å¸« (Admin Only)**: åœ¨ã€Œæ•™å¸«å¸³æˆ¶ç®¡ç†ã€å€å¡Šæ–°å¢å¸³è™Ÿã€‚
3.  **åŒ¯å…¥è³‡æ–™**: ä¸‹è¼‰ Excel ç¯„æœ¬ï¼Œå¡«å…¥ `thread_id` å¾Œä¸Šå‚³ï¼Œå³å¯æ‰¹æ¬¡åŠ å…¥å°è©±ç´€éŒ„ã€‚

---

## ğŸ”’ è³‡å®‰ç¨½æ ¸
ç³»çµ±æœƒè‡ªå‹•ç”¢ç”Ÿ `audit.log`ï¼Œè¨˜éŒ„é—œéµæ“ä½œè»Œè·¡ï¼š
```log
[2024-01-03 16:58:00] [User: Administrator] [Action: Create User] [Target: new_teacher] [Status: Success]
[2024-01-03 17:00:00] [User: teacher_abc] [Action: Delete Group] [Target: Math_Class] [Status: Success]
```

---

## ğŸ“‚ æª”æ¡ˆçµæ§‹
*   `app.py`: æ ¸å¿ƒå¾Œç«¯é‚è¼¯ã€‚
*   `templates/`: HTML é é¢ (index, login, admin, result)ã€‚
*   `threads.json`: å„²å­˜ç¾¤çµ„èˆ‡ Thread ID è³‡æ–™ã€‚
*   `users.json`: å„²å­˜æ•™å¸«å¸³è™Ÿè³‡æ–™ (å¯†ç¢¼å·² Hash)ã€‚
*   `settings.json`: ç³»çµ±è¨­å®š (Legacy)ã€‚
